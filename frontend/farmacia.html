<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farmácia - Produtos</title>

  <link rel="stylesheet" href="style.css"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

  <header class="cabecalho">
    <a href="index.html" class="localizacao"><i class="fas fa-arrow-left"></i> Voltar</a>
    <div class="busca">
      <input type="text" placeholder="Buscar produtos nesta farmácia...">
      <i class="fas fa-search"></i>
    </div>
    <div class="localizacao" style="display: flex; gap: 15px;">
      <a href="login.html" class="localizacao"><i class="fas fa-user-circle"></i> Entrar</a>
    </div>
  </header>

  <main class="container">
    <section id="farmacia-header" class="farmacia-info-header farmacia-card">
    </section>

    <nav class="produto-categorias-nav">
      <a href="#higiene" class="active">Medicamentos</a>
      <a href="#vitaminas">Higiene</a>
      <a href="#beleza">Vitaminas</a>
      <a href="#remedios">Beleza</a>
    </nav>

    <section class="secao-produtos">
      <h2 id="produtos-titulo">Produtos disponíveis</h2>
      <div class="produto-grid" id="lista-produtos">
      </div>
    </section>
  </main>

  <div class="carrinho-flutuante" id="carrinhoFlutuante" onclick="window.location.href='carrinho.html'">
    <i class="fas fa-shopping-cart"></i>
    <span>0 produtos | R$ 0,00</span>
  </div>

  <script src="/carrinho.js"></script>
  <script>
    function getQueryParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    async function carregarFarmacia() {
      const id = getQueryParam('id');
      if (!id) return alert('Nenhuma farmácia selecionada');

      const resFarmacia = await fetch(`/farmacias/${id}`);
      const farmacia = await resFarmacia.json();

      const header = document.getElementById('farmacia-header');
      header.innerHTML = `
        <img src="${farmacia.logo}" alt="Logo ${farmacia.nome}" class="farmacia-logo-large">
        <div class="info-details">
          <h1>${farmacia.nome}</h1>
          <p class="detalhes">
            <i class="fas fa-star" style="color: gold;"></i> ${farmacia.avaliacao}
            | Taxa de Entrega: ${farmacia.taxa} | Tempo: ${farmacia.tempoEntrega}
          </p>
          <p class="detalhes" style="color: ${farmacia.status.includes('Fechado') ? '#dc3545' : '#28a745'}; font-weight: bold;">
            <i class="fas fa-clock"></i> ${farmacia.status}
          </p>
        </div>
      `;

      const resProdutos = await fetch(`/produtos?farmaciaId=${id}`);
      const produtos = await resProdutos.json();

      const lista = document.getElementById('lista-produtos');
      lista.innerHTML = '';

      produtos.forEach(p => {
        lista.innerHTML += `
          <div class="produto-card">
            <img src="${p.imagem}" alt="${p.nome}" class="produto-imagem" onerror="this.src='/media/placeholder.png'">
            <p class="produto-nome">${p.nome}</p>
            <p class="produto-preco">R$ ${Number(p.preco).toFixed(2).replace('.', ',')}</p>
            <button class="adicionar-btn" data-id="${p.id}"><i class="fas fa-plus"></i></button>
          </div>
        `;
      });
      const botoes = lista.querySelectorAll('.adicionar-btn');
      botoes.forEach(btn => {
        btn.addEventListener('click', () => {
          const id = Number(btn.getAttribute('data-id'));
          const produto = produtos.find(x => x.id === id);
          if (!produto) {
            console.error('Produto não encontrado para id', id);
            return;
          }
          window.adicionarAoCarrinho({
            id: produto.id,
            nome: produto.nome,
            preco: produto.preco,
            imagem: produto.imagem || '/media/placeholder.png'
          });
        });
      });
    }
    carregarFarmacia();
  </script>
</body>
</html>
